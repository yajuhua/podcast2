<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- vue2 -->
    <script src="https://cdn.bootcdn.net/ajax/libs/vue/2.6.13/vue.js"></script>
    <!-- 引入组件库 -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <!--引入css  -->
    <link rel="stylesheet" href="css/manage.css">
    <!-- 引入样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!--    引入axios-->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!--网页logo-->
    <link rel="icon" href="imgs/logo_favicon.ico">
    <title>管理</title>
</head>

<body>
    <div id="app">

        <!--面包屑-->
        <div class="sidebar">

            <el-menu :default-active="activeMenu" class="el-menu-vertical-demo" @select="handleMenuSelect">
                <el-submenu index="system">
                    <template slot="title">系统</template>
                    <el-menu-item index="info">概况</el-menu-item>
                    <el-menu-item index="logs">日志</el-menu-item>
                </el-submenu>

                <el-submenu index="user">
                    <template slot="title">用户</template>
                    <el-menu-item index="changePassword">修改</el-menu-item>
                    <el-menu-item index="dataMigration">数据迁移</el-menu-item>
                </el-submenu>

                <el-submenu index="download">
                    <template slot="title">下载</template>
                    <el-menu-item index="Downloading">正在下载 {{this.downloadData.length > 0 ? this.downloadData.length:''}}</el-menu-item>
                    <el-menu-item index="Done">已完成 {{this.downloadDone.length > 0 ? this.downloadDone.length:''}}</el-menu-item>
                    <el-menu-item index="DownloaderInfo">下载器信息</el-menu-item>
                </el-submenu>


                <el-menu-item index="SubscriptionList" @click="toSubscriptionList">订阅列表</el-menu-item>
                <el-menu-item index="about">关于</el-menu-item>
                <el-menu-item index="exit" @click="exit">退出</el-menu-item>
            </el-menu>
        </div>

        <!--查看日志-->
        <div class="main">
            <div v-show="activeMenu === 'logs'">
                <title>实时日志页面</title>
                <div id="logspage">
                    <el-card>
                        <div slot="header" class="clearfix">
                            <span>实时日志</span>
                            <el-button style="float: right;" type="danger" @click="clearLogs">清除日志</el-button>
                        </div>
                        <div class="logs">
                            <template v-for="log in logs">
                                <p>{{ log }}</p>
                            </template>
                        </div>
                    </el-card>
                </div>
            </div>


            <!--显示项目介绍-->
            <div v-show="activeMenu === 'about'">
                <el-menu>
                    <el-menu-item>
                        <iframe  src="https://yajuhua.github.io" width="100%" height="1080" frameborder="0"></iframe>
                    </el-menu-item>
                </el-menu>
            </div>


            <!--修改用户名和密码-->
            <div v-show="activeMenu === 'changePassword'"><el-form :inline="true" :model="formInline"
                    class="demo-form-inline">
                    <el-form-item label="用户名">
                        <el-input v-model="formInline.user" placeholder="用户名"></el-input>
                    </el-form-item>

                    <el-form-item label="密码">
                        <el-input v-model="formInline.password" placeholder="密码"></el-input>
                    </el-form-item>
                    <el-form-item>

                        <el-button type="primary" @click="changeUserPasswd">修改</el-button>
                    </el-form-item>
                </el-form></div>


            <!--数据迁移-->
            <div v-show="activeMenu === 'dataMigration'">

                <el-button type="primary" round @click="dataImport">
                    导入
                    <!--ref属性用于重置文件，避免浏览器认为是同一个文件-->
                    <input type="file" class="custom-file-input" @change="handleFileSelect" ref="fileInput" />
                </el-button>
                <el-table
                        :data="channelData"
                        style="width: 100%"
                        @selection-change="selectionChannelData"
                        :row-class-name="tableRowClassName">
                    <el-table-column
                            type="selection"
                            width="55">
                    </el-table-column>
                    <el-table-column
                            prop="channelTitle"
                            label="频道名称"
                            >
                    </el-table-column>
                </el-table>
                <div class="footer">
                    <el-button type="success" round v-if="multipleSelectChannelData.length > 0" @click="dataExport">导出</el-button>
                </div>
            </div>

            <!--选择导入数据 -->
            <el-dialog
                    title="数据导入"
                    width="50%"
                    :visible.sync="importDataDialog"
                    >
                <div>
                    <el-table
                            :data="importData"
                            style="width: 100%"
                            @selection-change="selectionImportData"
                            :row-class-name="tableRowClassName">
                        <el-table-column
                                type="selection"
                                width="55">
                        </el-table-column>
                        <el-table-column
                                prop="channelTitle"
                                label="频道名称"
                        >
                        </el-table-column>
                    </el-table>
                </div>
                    <span slot="footer" class="dialog-footer">
                    <el-button @click="importDataDialog = false">取 消</el-button>
                    <el-button type="primary" @click="importChannelDataToService">导入</el-button>
                </span>
            </el-dialog>


            <!--查看正在下载-->
            <div v-show="activeMenu === 'Downloading'">
               <div>
                   <el-table
                           :data="downloadData"
                           style="width: 100%"
                           :row-class-name="tableRowClassName">
                       <el-table-column
                               prop="downloaderName"
                               label="下载器名称">
                       </el-table-column>
                       <el-table-column
                               prop="description"
                               label="描述">
                       </el-table-column>
                       <el-table-column
                               prop="totalSize"
                               label="文件大小">
                       </el-table-column>
                       <el-table-column
                               label="下载进度">
                           <!--使用slot-scope="scope"来访问表格中每行的数据-->
                           <el-progress slot-scope="scope" :text-inside="true" :stroke-width="26" :percentage="scope.row.percentage"></el-progress>
                       </el-table-column>
                       <el-table-column
                               prop="currentSpeed"
                               label="速度">
                       </el-table-column>
                       <el-table-column
                               prop="ETA"
                               label="剩余时间">
                       </el-table-column>
                   </el-table>
                   </el-form>
               </div>
            </div>



            <!--查看已完成-->
            <div v-show="activeMenu === 'Done'">
                <div>
                    <el-table
                            :data="downloadDone"
                            style="width: 100%"
                            @selection-change="handleSelectionDoneChange"
                            :row-class-name="tableRowClassName">
                        <el-table-column
                                type="selection"
                                width="55">
                        </el-table-column>
                        <el-table-column
                                prop="status"
                                label="状态">
                            <div slot-scope="scope">
                                <!--                            <span>{{ scope.row.status === 1 ? '✅ 成功' : '❌ 失败' }}</span>-->
                                <div v-if="scope.row.status === 1">
                                    <i class="el-icon-success">成功</i>
                                </div>
                                <div v-if="scope.row.status != 1">
                                    <i class="el-icon-error">失败</i>
                                </div>
                            </div>
                        </el-table-column>
                        <el-table-column
                                prop="downloaderName"
                                label="下载器名称">
                        </el-table-column>
                        <el-table-column
                                prop="description"
                                label="描述">
                        </el-table-column>
                        <el-table-column
                                prop="totalSize"
                                label="文件大小">
                        </el-table-column>
                        <el-table-column
                                label="下载进度">
                            <!--使用slot-scope="scope"来访问表格中每行的数据-->
                            <div slot-scope="scope">
                                <div v-if="scope.row.status === 1">
                                    <el-progress :text-inside="true" :stroke-width="26" :percentage="scope.row.percentage"></el-progress>
                                </div>
                                <div v-if="scope.row.status != 1">
                                    <el-progress :text-inside="true" :stroke-width="26" :percentage="scope.row.percentage" status="exception"></el-progress>
                                </div>
                            </div>

                        </el-table-column>
                        <el-table-column
                                prop="currentSpeed"
                                label="速度">
                        </el-table-column>
                        <el-table-column
                                prop="ETA"
                                label="剩余时间">
                        </el-table-column>
                        <el-table-column
                                prop="finalAt"
                                label="结束于">
                        </el-table-column>
                        <el-table-column
                                label="删除记录">
                            <el-button slot-scope="scope" type="danger" icon="el-icon-delete" circle @click="deleteDownloadRecord(scope.row.id)"></el-button>
                        </el-table-column>
                    </el-table>
                    </el-form>

                    <div class="footer">
                        <el-button type="danger" round v-if="multipleDoneSelection.length > 1" @click="deleteDownloadRecords">批量删除</el-button>
                    </div>
                </div>
            </div>


            <!--查看下载器信息-->
            <div v-show="activeMenu === 'DownloaderInfo'">
                <div>
                    <el-table
                            :data="DownloaderInfo"
                            style="width: 100%"
                            :row-class-name="tableRowClassName">
                        <el-table-column
                                prop="name"
                                label="名称">
                        </el-table-column>
                        <el-table-column
                                label="版本">
                            <el-tag :type="success" slot-scope="scope">{{scope.row.version}}</el-tag>
                        </el-table-column>
                    </el-table>
                </div>
            </div>


            <!--系统概况-->
            <div v-show="activeMenu === 'info'">
                <h2>系统概况</h2>
                <el-upload  class="upload-demo" ref="upload2" action="./system/uploadWarServlet" :on-preview="handlePreview2"
                           :on-remove="handleRemove2" :file-list="fileList" :auto-upload="false"
                           :on-success="handleResponse2">
                    <el-button slot="trigger" size="small" type="primary">选取war包</el-button>
                    <el-button style="margin-left: 10px;" size="small" type="success"
                               @click="submitUpload2">上传到服务器</el-button>
                    <el-button type="warning" @click="restart" size="small">重启系统</el-button>
                    <el-button type="danger" size="small" @click="updateSystem" v-if="preparingForUpdates==true">更新系统</el-button>

                </el-upload>

                <div>
                    <el-table :data="infoData" :row-class-name="tableRowClassName">
                        <el-table-column prop="key"></el-table-column>
                        <el-table-column prop="value"></el-table-column>
                    </el-table>

                    <!--插件列表-->
                    <h2>插件列表</h2>
                    <el-upload class="upload-demo" ref="upload1" action="./system/uploadServlet" :on-preview="handlePreview"
                        :on-remove="handleRemove" :file-list="fileList" :auto-upload="false"
                        :on-success="handleResponse">
                        <el-button slot="trigger" size="small" type="primary">选取插件</el-button>
                        <el-button style="margin-left: 10px;" size="small" type="success"
                            @click="submitUpload">上传到服务器</el-button>
                        <el-button type="danger" size="small" @click="deletePlugins">批量删除</el-button>
                    </el-upload>
                    <div>
                        <el-table :data="systemAllData1.pluginList" style="width: 100%"
                            :row-class-name="tableRowClassName" @selection-change="handleSelectionChange">
                            <el-table-column type="selection" width="55">
                            </el-table-column>
                            <el-table-column label="名称" width="180">
                                <template slot-scope="scope">{{ scope.row.name }}</template>
                            </el-table-column>
                            <el-table-column label="版本" width="180">
                                <template slot-scope="scope">{{ scope.row.version }}</template>
                            </el-table-column>
                            <el-table-column label="更新时间" prop="update">
                            </el-table-column>
                            <el-table-column label="操作">
                                <el-button type="danger" slot-scope="scope"
                                    @click="deletePlugin(scope.row)">删除</el-button>
                            </el-table-column>

                        </el-table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 引入管理页面js-->
    <script src="js/manage.js"></script>
</body>

</html>